apiVersion: hive.openshift.io/v1
kind: ClusterDeployment
metadata:
  name: '{{ managed_cluster_name }}'
  namespace: '{{ managed_cluster_name }}'
  labels:
    cloud: 'AWS'
    region: 'us-east-1'
    vendor: OpenShift
    cluster.open-cluster-management.io/clusterset: 'default'
spec:
  baseDomain: dragonslair.dev
  clusterName: '{{ managed_cluster_name }}'
  controlPlaneConfig:
    servingCertificates: {}
  installAttemptsLimit: 1
  installed: false
  platform:
    aws:
      credentialsSecretRef:
        name: {{ managed_cluster_name }}-aws-creds
      region: us-east-1
  provisioning:
    installConfigSecretRef:
      name: {{ managed_cluster_name }}-install-config
    sshPrivateKeySecretRef:
      name: {{ managed_cluster_name }}-ssh-private-key
    imageSetRef:
       #quay.io/openshift-release-dev/ocp-release:4.10.39-x86_64
      name: img4.10.39-x86-64-appsub
  pullSecretRef:
    name: {{ managed_cluster_name }}-pull-secret
---
apiVersion: cluster.open-cluster-management.io/v1
kind: ManagedCluster
metadata:
  labels:
    cloud: Amazon
    region: us-east-1
    name: '{{ managed_cluster_name }}'
    vendor: OpenShift
    cluster.open-cluster-management.io/clusterset: 'default'
  name: '{{ managed_cluster_name }}'
spec:
  hubAcceptsClient: true
---
apiVersion: hive.openshift.io/v1
kind: MachinePool
metadata:
  name: {{ managed_cluster_name }}-worker
  namespace: '{{ managed_cluster_name }}'
spec:
  clusterDeploymentRef:
    name: '{{ managed_cluster_name }}'
  name: worker
  platform:
    aws:
      rootVolume:
        iops: 2000
        size: 100
        type: io1
      type: m5.xlarge
  replicas: 3
---
apiVersion: v1
kind: Secret
metadata:
  name: {{ managed_cluster_name }}-pull-secret
  namespace: '{{ managed_cluster_name }}'
data:
  .dockerconfigjson: >-
    eyJhdXRocyI6eyJjbG91ZC5vcGVuc2hpZnQuY29tIjp7ImF1dGgiOiJiM0JsYm5Ob2FXWjBMWEpsYkdWaGMyVXRaR1YySzNKb2JtZHdjMmhtWlc1dVpYSXhlbmhwWjJSb1ltUjVOVFowYzJWbGFHMDFhR3RrTlRSdlkyRTZORVpaUTFaRFdrOHpTVUk0VVRGWlVWcFpURFZWTjFkSFNETkhNRVJFVVZneFNFZGFVMVEyV2xCVU16UkpTVTA0V1ZkUU1Gb3hTbGRGU2pjNFZEZFFOQT09IiwiZW1haWwiOiJoZmVubmVyQHJlZGhhdC5jb20ifSwicXVheS5pbyI6eyJhdXRoIjoiYjNCbGJuTm9hV1owTFhKbGJHVmhjMlV0WkdWMkszSm9ibWR3YzJobVpXNXVaWEl4ZW5ocFoyUm9ZbVI1TlRaMGMyVmxhRzAxYUd0a05UUnZZMkU2TkVaWlExWkRXazh6U1VJNFVURlpVVnBaVERWVk4xZEhTRE5ITUVSRVVWZ3hTRWRhVTFRMldsQlVNelJKU1UwNFdWZFFNRm94U2xkRlNqYzRWRGRRTkE9PSIsImVtYWlsIjoiaGZlbm5lckByZWRoYXQuY29tIn0sInJlZ2lzdHJ5LmNvbm5lY3QucmVkaGF0LmNvbSI6eyJhdXRoIjoiTlRNeU9EYzBOakI4ZFdoakxURmFlRWxuUkVoaVpIazFObFJUWlVWSWJUVm9TMlExTkU5RFFUcGxlVXBvWWtkamFVOXBTbE5WZWxWNFRXbEtPUzVsZVVwNlpGZEphVTlwU21wT2VrNXNUV3BOZDFwWFdtMU5NbFV3VFZST2FFOUVVbXBaTWtrd1RrZE9iVmxxYUdwYVIxRXdUWGxLT1M1UlVsWjVhakkyVmxnNGVFbG1kREZtUWxaT2VETm1MV3R2YUUweVFXZDNWMDgyT1RadlJuaHJPSFpIYVhWSE1FSlRaWE5aZG5JNVJ6QjRVbTFUT0d0Vk5uUk9lalI0TVZSUldFUXhTV3BIVEVwdE1uRnhlbE5xY2pGU2RHeERkM0ozTTNsMloxSTVkRzl2T1dSR2RWaFlOVWRDYVUxMVh6VlJhbkJ0VlRGdE56WndZbXN5UjNwVGRtcFdXVGR1VUhGVFIwOW9TblZaVUU1TlFrSkdObUl5ZFdac1Z6VTBiRUUyWkZkMU0yaGhMVEF4UkRsQ1VrSkZURFkxY2w5MFJqaHVTbUZ2UWpCUWVUUlpPVTloVldoSk9FRlpjazR4YlRKRGNHODFkMVUxY1VOSGRuSnhjVTFpTW1kNE1uZDFXRWhhV2s1aFUydEljRzFJWkdSVFp6Rk5TSGgxYkZCTWJuQnBTSEJsZFZOV1MycGhSbEp2T1RnM1FVRmFSMTlKVTNOVWRETkVVbGxNWTFGd2MwZGhiV3c1VDNsUVdESlhkVmRUTm1KeWMyRlBZamcxUldGcVRVdHdNVlJ0Tm1WT2RuZEdhRVU0ZDB0eFVtMDBORTluV0VwRmJXRklXbkpHVm00dFJIQnRja3BoWVRaa1YzTlpjemRtYlVrelMyNTZiV05VWm5GaE9HNVBPVTVqVlVSeFFpMUhPRkpQWTNkbU1ERmxVVTFzV1daSFUySklaemx0YlVWTU1FbHdNbXhqTW14cmRVZFRSa2RRTlhkbFdEQTJhV0Z6ZVdzdFprVnVObFEwU1dSeFVUTnFZa1l3TlY4NWFrSjZRM2RpWlRoTVpFdERTM001VjBWSGIwYzNjVGR3Y2tFelRrNDNZMWQ0YXpsbExYbDZOSFpFTmpGdGFXWk1MVGx0UlcxVFlVbGZXV2N5U1ZkVlRrVmFRM05rVEc5bGIySmlPRVZ3VFVKSldXZE9hWGRZUkVKaGExRTNXV3RtVWsxMVYyZHlUbVJpU2tWSVJGTnNVakJoUlZkTFRWODJXbTFHWlU1WVdVd3hlVjlQWkcxWFluQjJXbVY2UjNCeGJVdDBOa0pQYVhSUGFreHBlbFJhYjFJNFJISnlkMmR3U1hGVlZFdGxUVFZmWjNWS2FFTk5RMGgwTlc1emJISnpRbWhpY1ZoblV6ZElOVloyYkZOMVEzVmpRa2xsWnc9PSIsImVtYWlsIjoiaGZlbm5lckByZWRoYXQuY29tIn0sInJlZ2lzdHJ5LnJlZGhhdC5pbyI6eyJhdXRoIjoiTlRNeU9EYzBOakI4ZFdoakxURmFlRWxuUkVoaVpIazFObFJUWlVWSWJUVm9TMlExTkU5RFFUcGxlVXBvWWtkamFVOXBTbE5WZWxWNFRXbEtPUzVsZVVwNlpGZEphVTlwU21wT2VrNXNUV3BOZDFwWFdtMU5NbFV3VFZST2FFOUVVbXBaTWtrd1RrZE9iVmxxYUdwYVIxRXdUWGxLT1M1UlVsWjVhakkyVmxnNGVFbG1kREZtUWxaT2VETm1MV3R2YUUweVFXZDNWMDgyT1RadlJuaHJPSFpIYVhWSE1FSlRaWE5aZG5JNVJ6QjRVbTFUT0d0Vk5uUk9lalI0TVZSUldFUXhTV3BIVEVwdE1uRnhlbE5xY2pGU2RHeERkM0ozTTNsMloxSTVkRzl2T1dSR2RWaFlOVWRDYVUxMVh6VlJhbkJ0VlRGdE56WndZbXN5UjNwVGRtcFdXVGR1VUhGVFIwOW9TblZaVUU1TlFrSkdObUl5ZFdac1Z6VTBiRUUyWkZkMU0yaGhMVEF4UkRsQ1VrSkZURFkxY2w5MFJqaHVTbUZ2UWpCUWVUUlpPVTloVldoSk9FRlpjazR4YlRKRGNHODFkMVUxY1VOSGRuSnhjVTFpTW1kNE1uZDFXRWhhV2s1aFUydEljRzFJWkdSVFp6Rk5TSGgxYkZCTWJuQnBTSEJsZFZOV1MycGhSbEp2T1RnM1FVRmFSMTlKVTNOVWRETkVVbGxNWTFGd2MwZGhiV3c1VDNsUVdESlhkVmRUTm1KeWMyRlBZamcxUldGcVRVdHdNVlJ0Tm1WT2RuZEdhRVU0ZDB0eFVtMDBORTluV0VwRmJXRklXbkpHVm00dFJIQnRja3BoWVRaa1YzTlpjemRtYlVrelMyNTZiV05VWm5GaE9HNVBPVTVqVlVSeFFpMUhPRkpQWTNkbU1ERmxVVTFzV1daSFUySklaemx0YlVWTU1FbHdNbXhqTW14cmRVZFRSa2RRTlhkbFdEQTJhV0Z6ZVdzdFprVnVObFEwU1dSeFVUTnFZa1l3TlY4NWFrSjZRM2RpWlRoTVpFdERTM001VjBWSGIwYzNjVGR3Y2tFelRrNDNZMWQ0YXpsbExYbDZOSFpFTmpGdGFXWk1MVGx0UlcxVFlVbGZXV2N5U1ZkVlRrVmFRM05rVEc5bGIySmlPRVZ3VFVKSldXZE9hWGRZUkVKaGExRTNXV3RtVWsxMVYyZHlUbVJpU2tWSVJGTnNVakJoUlZkTFRWODJXbTFHWlU1WVdVd3hlVjlQWkcxWFluQjJXbVY2UjNCeGJVdDBOa0pQYVhSUGFreHBlbFJhYjFJNFJISnlkMmR3U1hGVlZFdGxUVFZmWjNWS2FFTk5RMGgwTlc1emJISnpRbWhpY1ZoblV6ZElOVloyYkZOMVEzVmpRa2xsWnc9PSIsImVtYWlsIjoiaGZlbm5lckByZWRoYXQuY29tIn19fQ==
type: kubernetes.io/dockerconfigjson
---
apiVersion: v1
kind: Secret
metadata:
  name: {{ managed_cluster_name }}-install-config
  namespace: '{{ managed_cluster_name }}'
type: Opaque
data:
  # Base64 encoding of install-config yaml
  install-config.yaml: YXBpVmVyc2lvbjogdjEKbWV0YWRhdGE6CiAgbmFtZTogJ2RpcnQnCmJhc2VEb21haW46IGRyYWdvbnNsYWlyLmRldgpjb250cm9sUGxhbmU6CiAgaHlwZXJ0aHJlYWRpbmc6IEVuYWJsZWQKICBuYW1lOiBtYXN0ZXIKICByZXBsaWNhczogMwogIHBsYXRmb3JtOgogICAgYXdzOgogICAgICByb290Vm9sdW1lOgogICAgICAgIGlvcHM6IDQwMDAKICAgICAgICBzaXplOiAxMDAKICAgICAgICB0eXBlOiBpbzEKICAgICAgdHlwZTogbTUueGxhcmdlCmNvbXB1dGU6Ci0gaHlwZXJ0aHJlYWRpbmc6IEVuYWJsZWQKICBuYW1lOiAnd29ya2VyJwogIHJlcGxpY2FzOiAzCiAgcGxhdGZvcm06CiAgICBhd3M6CiAgICAgIHJvb3RWb2x1bWU6CiAgICAgICAgaW9wczogMjAwMAogICAgICAgIHNpemU6IDEwMAogICAgICAgIHR5cGU6IGlvMQogICAgICB0eXBlOiBtNS54bGFyZ2UKbmV0d29ya2luZzoKICBuZXR3b3JrVHlwZTogT3BlblNoaWZ0U0ROCiAgY2x1c3Rlck5ldHdvcms6CiAgLSBjaWRyOiAxMC4xMjguMC4wLzE0CiAgICBob3N0UHJlZml4OiAyMwogIG1hY2hpbmVOZXR3b3JrOgogIC0gY2lkcjogMTAuMC4wLjAvMTYKICBzZXJ2aWNlTmV0d29yazoKICAtIDE3Mi4zMC4wLjAvMTYKcGxhdGZvcm06CiAgYXdzOgogICAgcmVnaW9uOiB1cy1lYXN0LTEKcHVsbFNlY3JldDogIiIgIyBza2lwLCBoaXZlIHdpbGwgaW5qZWN0IGJhc2VkIG9uIGl0J3Mgc2VjcmV0cwpzc2hLZXk6IHwtCiAgICBzc2gtcnNhIEFBQUFCM056YUMxeWMyRUFBQUFEQVFBQkFBQUJnUURQMFZYQlFHdkJXZlBFN1YwN3phSDdSVjdGUXBITktMTWdkaWNCUEJsb09JRFo0WWswcHpnNHI0eUpOY0prWFpYZVN1dHJPR1Rkb1BLQ1IxT2l3S0lqQXYzcm1JMVgxZXdqbzgwdjAxdmFFWmphSUVEdXNxSFRzeTVzbytoaE1XTGFXbkpTcEFjSFgrVTAxU2RoTURlU05yVWNUd2RoTjBjdkF5SUY4cm51T2d4ZktONnZFTHF3TzUvbXhBMWVZU3RSSG1TUldmQkxCRnJvLzIxWDNkQU1qNXJjMGE1aXdoblM0b1R3K2hjVmZ2RXNtcFptclZrcjVsMXJxT0c1dUhDWkZPWTRJZEtQRCsvR0hFb1RkK3BINEQ5TDlIWGZ3NnlZdGVOL3lxUW5oS0d4NlJEbXNXS0MrWHpDcEhFdTdVdnpzcDc4QS9YQkpuYTZLRzQ4UCtpUStOSVRJRVdWQUtUZ3MxUndVM1NCUHFNRTFjVlFOYmdveTREVEh3RkM1UW0zWkJrUE1WKzhzSVRzME5hdldybWhtTy9SZmpvNDdRWTFsek8rSUVYTnp0ZzV1a2JETksyRlFCUHRQMklRazlFMkZxb2FlbGpmV3hMUlh2L2piVXVpQVFWMnFRY0VqQjBPMk5ZS2g3dm81VE5adFZwN2xwRU81d25TQzRtZ3JEVT0gaHRmZW5uZXJASG9sZGVucy1NYWNCb29rLVByby0yLmxvY2FsCg==
---
apiVersion: v1
kind: Secret
metadata:
  name: {{ managed_cluster_name }}-ssh-private-key
  namespace: '{{ managed_cluster_name }}'
stringData:
  ssh-privatekey: |-
    {{ ssh_private_key | indent(width=4) }}
type: Opaque
---
apiVersion: v1
kind: Secret
type: Opaque
metadata:
  name: {{ managed_cluster_name }}-aws-creds
  namespace: '{{ managed_cluster_name }}'
stringData:
  aws_access_key_id: {{ aws_access_key_id }}
  aws_secret_access_key: {{ aws_secret_access_key }}
---
apiVersion: agent.open-cluster-management.io/v1
kind: KlusterletAddonConfig
metadata:
  name: '{{ managed_cluster_name }}'
  namespace: '{{ managed_cluster_name }}'
spec:
  clusterName: '{{ managed_cluster_name }}'
  clusterNamespace: '{{ managed_cluster_name }}'
  clusterLabels:
    cloud: Amazon
    vendor: OpenShift
  applicationManager:
    enabled: true
  policyController:
    enabled: true
  searchCollector:
    enabled: true
  certPolicyController:
    enabled: true
  iamPolicyController:
    enabled: true
